# DynamicProceduralCityGenerator
This project is a Tool developed as a Final Degree Project that aims to generate procedural cities (or intrincate structures) in runtime, given a set of ampliable data.
The documentation of the research and development process can be found here: https://drive.google.com/file/d/19Qys58agLmkSDtchciYuTNX5Shs9ISn3/view?usp=sharing

[Click to watch the Demo](https://youtu.be/Ubeb8ppgGjQ)<br>
[![Watch the video](https://i.imgur.com/gj2CZ7L.png)](https://youtu.be/Ubeb8ppgGjQ)

# Use Guide
The following seccion describes both the instructions to use the tool, and the description of each field the inspector offers.

## Instalation
This Tool has been designed to be used in the Unity Engine environment.
<br>**Step 1**. Download the tool using the following link: https://drive.google.com/file/d/1CJ2DCpTZ3su0GTCtyC889WOkzlml5TR_/view?usp=sharing
<br>**Step 2**. Download and install the Unity Engine Editor.
<br>**Step 3**. Start the editor.
<br>**Step 4**. Import the tool to the editor. This can be done opening the file downloaded, or dragging the file to the editor.

## Layer Definition
This tool uses various _layers_ to make searches and physics calculations more efficiently. Therefore, the user must define those _layers_ and apply them to the configuration of derivate objects.
Those _layers_ are:
- **Terrain**: Used by Unity's terrains.
- **Road Colliders**: Used to detect roads.
- **Building Colliders**: Used to detect and place buildings.

## Initial Configuration
To use the tool, first the scene on which the tool is being used must be configured.
<br>**Step 1**. Import the _prefab_ called "DynamicProceduralUrbanGeneratorManager.prefab" to the scene.
<br>**Step 2**. Add one or more buildings and signal the probability of each one on the appropiate parameter.
<br>**Step 3**. Signal the appropiate _layers_ on each component (further explained below).
<br>**Step 4**. At least one terrain layer must be referenced (further explained below).
<br>**Step 5**. Configure the components of the object following the desired design. The configuration of each component is explained in the following sections.
<br>**Step 6**. Enable the created object.
<br>**Step 7**. Run the Scene.

## Building Creation
Buildings are the main component of the tool. To create a new building follow the steps:
<br>**Step 1**. Duplicate the "BuildingPreset" prefab template.
<br>**Step 2**. Rename the prefab.
<br>**Step 3**. Open the prefab to edit it.
<br>**Step 4**. Add the desired building object as a child of the "_prefab_/Element/Mesh" object.
<br>**Step 5**. Modify the "_prefab_/Elements/GenerationColliders" object's colliders to better adapt the building model. Colliders can be added or removed, but a collider component must always exist. The valid colliders are: Box Collider, Sphere Collider, and Capsule Collider, and the "Is Trigger" box must be always enabled.
<br>**Step 6**. Modify the "GenerationColliders" object's layer to the _layer_ assigned to "Building Colliders".
<br>**Step 7**. Modify and add empty objects as children of "_prefab_/Elements/Entrances" in the relative positions to the parent object, where the main object is desired to join a road, and with the forward vecotr pointing the direction in which the road is expected to be. As an important note, an entrance can not be inside an area of a collider with the layer "Building Colliders".
<br>**Step 8**. Modify the "_prefab_/Elements/Floor" object's Box Collider to signal the size of the terrain that's going to be adapted for the building foundations.
<br>**Step 9**. In the "Building Bounding Box" component of the parent objects, three parameters must be assigned: 
- **Collider Holder**: A reference to the container object of the building's _colliders_, created and modified during the **step 5**. This object must have the "Building Colliders" layer.
- **Entrance Game Object List**: In this list, all objects created or modified in **step 7** must be referenced.
- **Floor Holder**: A reference to the object modified in **step 8**.

# Parameters
## Dynamica Procedural Urban Generator Manager
This component is the administrator of all other components that the tool uses, ensuring a single entry point. <br>
The only parameter it has it's the "enable" checkbox, that toggles the tool on and off.

## Hexagonal Grid
This component builds an _organic irregular grid_ that will hold the foundations of the roads generated.
<br> _Parameters_:
- **Point Equality Max Distance**: This parameter is the allowed margin of error for two points on the hexagonal grid to be considered in the same position. This parameter corrects local coordinate errors generated by floating-point calculations in cubic root calculations.
- **Relax Value**: This parameter indicates the intensity of the relaxation algorithm for the irregular organic grid.
- **Chunk Size**: This parameter indicates the radius in triangles of each cell of the irregular organic grid.
- **Hexagon Size**: This parameter indicates the size of each triangle in the irregular organic grid.

## Terrain Shape
This component is responsible for creating, modifying, and managing the terrain objects of the tool.
<br> _Parameters_:
- **Terrain Layer**: This parameter indicates the number of the layer used as "Terrain."
- **Terrain Holder**: This parameter requires a reference to an object to act as the parent of the generated terrain objects. If left null, the parent of these terrain objects will be the component object itself.
- **Square Resolution**: This parameter is equivalent to the "alphamapResolution" of the generated terrains.
- **Size**: This parameter is equivalent to the "size" of the generated terrains.
- **Altitude**: This parameter indicates the maximum altitude in units that the terrain can reach.
- **Shape Scale**: This parameter comprises the size of the noise map used to determine the shape of the terrain.
- **Texture Scale**: This parameter comprises the size of the texture maps used in the materials of the terrains.
- **Terrain Layers**: This parameter requires references to the terrain layer objects that the algorithm will use. In the current version, a maximum of two objects will be used, though altering this number should not pose any complications.
- **Terrain Material**: This parameter requires a reference to the material used by the terrain.
- **Road Paint Amplitude Multiplier**: This parameter comprises the relationship between the size of a road and the area to paint the terrain under that road with the appropriate layer.
- **Road Paint Falloff Start**: This parameter indicates the intensity with which terrain layers overlap under the roads.

## Road Generation
This component is responsible for generating and managing the roads in the tool.
<br> _Parameters_:
- **Road Colliders Holder**: This parameter requires a reference to an object to act as the parent of the colliders generated by the roads. If left null, the parent of these objects will be the component object itself.
- **Max Width**: This parameter is not currently used by the tool.
- **Min Width**: This parameter is not currently used by the tool.
- **Initial Width**: This parameter indicates the width of the roads generated by the tool.
- **Straight Roads Bias**: This parameter comprises a cubic growth value that indicates the probability that roads generated at a bifurcation will be straight rather than angled.
- **Road Diversion Curve**: This parameter comprises a function indicating the probability of generating more or fewer roads at bifurcations. The x value indicates the number of roads (from 0 to n, where n is the maximum number of possible roads), and the y value indicates the probability of generating x number of roads.
- **Automatic Road Expansion Distance**: This parameter indicates the minimum distance between an unexpanded road and a player for the road to expand automatically.
- **Visible Layers By Camera Frustum**: This parameter receives the list of layers comprising objects visible by the camera.
- **Road Colliders Layer**: This parameter indicates the number of the layer used as "Road Colliders."

## Building Generation
This component is responsible for populating the roads with buildings.
<br> _Parameters_:
- **Building List**: This parameter comprises a list of building objects, given as prefabs, that the tool can use.
- **Weight Probability List**: This parameter comprises another list, directly linked to the "Building List." This list indicates the probability of each building in the "Building List" appearing.
- **Building Collider Layer**: This parameter indicates the number of the layer used as "Building Colliders."
- **Building Holder**: This parameter requires a reference to an object to act as the parent of the generated buildings. If left null, the parent of these objects will be the component object itself.
- **Max Rotation**: This parameter indicates the maximum random rotation in degrees that can be applied to a building when it is generated.
- **Initial Deviation**: This parameter indicates the amount of deviation the tool should test when generating a building.
- **Final Deviation**: This parameter indicates the minimum deviation the tool should use. The smaller this value, the more precise the tool will be.
- **Deviation Shrink Rate**: This parameter indicates the rate at which the initial deviation decreases towards the final deviation. (Requires a positive value)
- **Building Generation Layer Mask**: This parameter comprises a list of layers with which the buildings can collide. Normally, these layers are "Building Colliders" and "Road Colliders."
- **Max Number of Generation Tries**: This parameter indicates the number of buildings the tool should try to fit into a space before determining that no building can fit.

## Decoration Manager
This component decorates the roads once they are generated, using prefabs provided as parameters.
<br> _Parameters_:
- **Decoration Holder**: This parameter requires a reference to an object to act as the parent of the generated decorations. If left null, the parent of these objects will be the component object itself.
- **Terrain Layers**: This parameter comprises a list of layers on which the decorations should be placed. Normally, these layers are only "Terrain."
- **Road Floor Decorations**: This parameter comprises a list of prefabs that will be used to decorate the generated roads.
- **Floor Decoration Density**: This parameter indicates the density of objects generated per unit of space on a road.
- **Floor Decoration Spacing**: This parameter indicates the maximum distance from the road at which objects will be generated.
